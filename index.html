<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ch√∫c M·ª´ng Sinh Nh·∫≠t</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<style>
*{ box-sizing:border-box; }
body{
    margin:0;
    min-height:100vh;
    background:#ffc0cb;
    font-family: 'Segoe UI', sans-serif;
    padding:20px;
    overflow-x:hidden;
}

.hearts{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:0;
}
.heart{
    position:absolute;
    font-size:22px;
    opacity:0.6;
    color:#e84d6d;
    animation: float 5s ease-in-out infinite;
}
.heart:nth-child(1){ left:8%; top:12%; animation-delay:0s; }
.heart:nth-child(2){ left:18%; bottom:20%; animation-delay:0.6s; }
.heart:nth-child(3){ right:12%; top:18%; animation-delay:1.2s; }
.heart:nth-child(4){ right:10%; bottom:18%; animation-delay:1.8s; }
.heart:nth-child(5){ left:10%; bottom:35%; animation-delay:2.4s; }
.heart:nth-child(6){ right:22%; top:35%; animation-delay:0.3s; }
.heart:nth-child(7){ left:28%; top:8%; animation-delay:0.9s; }
.heart:nth-child(8){ right:18%; bottom:40%; animation-delay:1.5s; }
.love-floats{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:0;
}
.love-float{
    position:absolute;
    font-size:20px;
    opacity:0.55;
    animation: float 6s ease-in-out infinite;
}
.love-float:nth-child(1){ left:12%; top:25%; animation-delay:0.2s; }
.love-float:nth-child(2){ right:15%; top:22%; animation-delay:1s; }
.love-float:nth-child(3){ left:22%; bottom:28%; animation-delay:2.2s; }
.love-float:nth-child(4){ right:8%; bottom:25%; animation-delay:0.8s; }
.love-float:nth-child(5){ left:5%; top:45%; animation-delay:1.6s; }
.love-float:nth-child(6){ right:25%; top:48%; animation-delay:2.8s; }
.love-float:nth-child(7){ left:35%; top:15%; animation-delay:0.5s; }
.love-float:nth-child(8){ right:30%; bottom:35%; animation-delay:1.8s; }
@keyframes float{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-10px); }
}

.page-wrap{ position:relative; z-index:1; max-width:480px; width:92%; margin:0 auto; text-align:center; display:none; min-height:100vh; padding:20px 0; box-sizing:border-box; }
.page-wrap.show{ display:flex; flex-direction:column; justify-content:center; align-items:center; }
.title{
    font-size:1.4rem;
    font-weight:700;
    color:#6b2d4a;
    text-transform:uppercase;
    letter-spacing:1px;
    margin:0 0 6px 0;
}
.subtitle{
    font-family: 'Dancing Script', cursive;
    font-size:1.5rem;
    font-weight:600;
    color:#6b2d4a;
    margin:0 0 20px 0;
    letter-spacing:0.5px;
}

.hint{
    font-size:0.85rem;
    color:rgba(107,45,74,0.7);
    margin-top:12px;
}

/* Card: b√¨a = 1 ·∫£nh maid.jpg full, click l·∫≠t ph·∫£i sang tr√°i, b√™n trong tr√°i = ·∫£nh, ph·∫£i = l·ªùi ch√∫c */
.card-wrap{
    perspective:1800px;
    margin:20px auto;
    max-width:420px;
    width:90%;
}
.card-spread{
    position:relative;
    display:flex;
    min-height:350px;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 12px 40px rgba(0,0,0,0.2);
}

/* B√™n trong: ch·ªâ ·∫£nh + n√∫t, kh√¥ng khung tr·∫Øng */
.inside{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    background:transparent;
    padding:0;
}
.inside-img{
    width:100%;
    display:block;
    vertical-align:top;
    min-height:300px;
    object-fit:contain;
}

/* B√¨a = 1 ·∫£nh full (maid.jpg), l·∫≠t t·ª´ ph·∫£i sang tr√°i */
.cover{
    position:absolute;
    left:0;
    top:0;
    width:100%;
    height:100%;
    transform-style: preserve-3d;
    transform-origin: left center;
    cursor:pointer;
    z-index:2;
}
.cover.flipped{
    animation: cover-flip 1.1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    pointer-events:none;
}
@keyframes cover-flip{
    0%{ transform: rotateY(0) rotateX(0deg); }
    25%{ transform: rotateY(-45deg) rotateX(3deg); }
    50%{ transform: rotateY(-90deg) rotateX(4deg); }
    75%{ transform: rotateY(-135deg) rotateX(2deg); }
    100%{ transform: rotateY(-180deg) rotateX(0deg); }
}
.cover-front,
.cover-back{
    position:absolute;
    inset:0;
    -webkit-backface-visibility:hidden;
    backface-visibility:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
}
.cover-front{
    background:#fef6f8;
}
.cover-front img{
    width:100%;
    height:100%;
    object-fit:cover;
}
.cover-back{
    background: linear-gradient(135deg, #f5e6ea 0%, #ebe0e4 100%);
    transform: rotateY(180deg);
}

.card-body h3{
    margin:0 0 12px 0;
    font-size:0.9rem;
    color:#6b2d4a;
    text-transform:uppercase;
}
.card-body p{
    margin:0 0 8px 0;
    font-size:0.9rem;
    line-height:1.6;
    color:#4a2d3a;
}
.card-body p:last-child{ margin-bottom:0; }

.view{ display:none; }
.view.active{ display:block; }

/* Trang nh·∫≠p m·∫≠t kh·∫©u (g·ªôp ƒë·ªÉ nh·∫°c xuy√™n su·ªët) - ch·ªâ hi·ªán khi .active */
#passwordView{ display:none; justify-content:center; align-items:center; min-height:100vh; }
#passwordView.active{ display:flex; justify-content:center; align-items:center; }
#passwordView .landing{ transition: opacity 0.6s ease; width:100%; display:flex; justify-content:center; align-items:center; }
#passwordView .landing.fade-out{ opacity:0; pointer-events:none; }
.password-view{ display:flex; justify-content:center; align-items:center; width:100%; }
.password-view .pwd-card{
    display:flex; align-items:stretch; max-width:580px; width:90%;
    margin:0 auto;
    background: rgba(255,255,255,0.4); backdrop-filter: blur(15px);
    border-radius:28px; box-shadow:0 15px 40px rgba(0,0,0,0.15); position:relative; z-index:1;
    overflow:hidden;
}
.password-view .pwd-card-img{
    flex:0 0 42%; min-width:200px; display:flex; border-radius:28px 0 0 28px; overflow:hidden;
}
.password-view .pwd-card .avatar{ width:100%; height:100%; object-fit:cover; display:block; }
.password-view .pwd-card .card-body{ flex:1; min-width:0; padding:28px; display:flex; flex-direction:column; justify-content:center; }
.password-view .pwd-title{ font-size:17px; color:#b03060; margin:0 0 18px 0; text-align:left; }
.password-view .password-display{
    background: rgba(255,255,255,0.6); padding:12px 16px; border-radius:15px;
    letter-spacing:4px; font-size:20px; min-height:28px; margin-bottom:22px; text-align:left;
}
.password-view .keypad{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
.password-view .key{
    padding:14px; border:none; border-radius:15px; background:#e84d6d; color:white;
    font-size:17px; cursor:pointer; transition:0.2s;
}
.password-view .key:hover{ background:#ff4d6d; }
.password-view .key.special{ background:#ffa6c1; }
.password-view .key.special:hover{ background:#ffb3cd; }
.password-view .pwd-msg{ margin-top:14px; padding:10px 14px; border-radius:12px; font-size:14px; font-weight:500; text-align:center; min-height:20px; transition: all 0.3s ease; }
.password-view .pwd-msg:not(:empty){ background: rgba(255,255,255,0.5); color:#8b2942; box-shadow:0 2px 10px rgba(0,0,0,0.08); }
.password-view .pwd-msg.success{ background: linear-gradient(135deg, #ffb3c6, #ffd6e0); color:#b03060; font-size:15px; animation: messagePop 0.4s ease; }

/* N√∫t l·∫≠t sang trang qu√† - t√°ch ra ngo√†i, ch·ªâ hi·ªán sau khi m·ªü b√¨a */
.btn-next-wrap{
    margin-top:20px;
    text-align:center;
    opacity:0;
    pointer-events:none;
    transition: opacity 0.3s ease;
}
.btn-next-wrap.show{
    opacity:1;
    pointer-events:auto;
}
.btn-next-page{
    display:inline-block;
    margin:0 auto;
    padding:14px 32px;
    background: linear-gradient(180deg, #9b59b6, #8e44ad);
    color:#fff;
    font-size:1rem;
    font-weight:600;
    border:none;
    border-radius:24px;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(142,68,173,0.4);
    transition: transform 0.2s;
}
.btn-next-page:hover{ transform: scale(1.03); }

/* Trang qu√† - h·ªôp 3D ƒë·∫πp + confetti khi m·ªü */
.gift-page{
    min-height:70vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    perspective:1000px;
}
.gift-box-wrap{
    position:relative;
    width:260px;
    height:200px;
    margin:0 auto 28px;
    cursor:pointer;
    transform-style:preserve-3d;
}
.gift-body{
    position:absolute;
    bottom:0;
    left:50%;
    margin-left:-130px;
    width:260px;
    height:150px;
    background:linear-gradient(180deg, #ff416c, #ff4b2b);
    border-radius:0 0 20px 20px;
    box-shadow:0 20px 40px rgba(0,0,0,0.3);
}
.gift-body::before{
    content:'';
    position:absolute;
    inset:0;
    background:radial-gradient(circle at center, #fff6b7, transparent 70%);
    filter:blur(12px);
    opacity:0;
    transition:opacity 0.6s;
    border-radius:0 0 20px 20px;
}
.gift-box-wrap.opened .gift-body::before{
    opacity:1;
}
.gift-body::after{
    content:'';
    position:absolute;
    left:50%;
    top:0;
    width:30px;
    height:100%;
    background:rgba(255,255,255,0.9);
    transform:translateX(-50%);
}
.gift-lid{
    position:absolute;
    bottom:150px;
    left:50%;
    margin-left:-143px;
    width:286px;
    height:60px;
    background:linear-gradient(180deg, #ff2e63, #c9184a);
    border-radius:20px 20px 0 0;
    box-shadow:0 -8px 20px rgba(0,0,0,0.25);
    transition:1s ease;
    transform-origin:left bottom;
}
.gift-box-wrap.opened .gift-lid{
    transform:rotate(-120deg) translateY(-40px);
    pointer-events:none;
}
.btn-open-gift{
    display:inline-block;
    padding:14px 32px;
    background: linear-gradient(180deg, #9b59b6, #8e44ad);
    color:#fff;
    font-size:1.05rem;
    font-weight:600;
    border:none;
    border-radius:28px;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(142,68,173,0.4);
    transition: transform 0.2s;
}
.btn-open-gift:hover{ transform: scale(1.05); }

.memory-container{
    position:fixed;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index:999;
}
.memory-img{
    position:absolute;
    width:160px;
    border-radius:20px;
    box-shadow:0 20px 40px rgba(0,0,0,0.35);
    opacity:0;
}
.memory-img.hero{
    left:50%;
    bottom:200px;
    transform:translateX(-50%) scale(0);
}

/* ·∫®n h·ªôp qu√† + n√∫t sau khi m·ªü (transition m∆∞·ª£t) */
.gift-box-wrap,
.btn-open-gift{
    transition: opacity 0.5s ease, transform 0.5s ease;
}
.gift-box-wrap.hide,
.btn-open-gift.hide{
    opacity:0;
    pointer-events:none;
    visibility:hidden;
}
.gift-box-wrap.hide{ transform: scale(0.9); }

/* 1Ô∏è‚É£ Viewport (khung nh√¨n) */
.marquee{
    display:none;
    width:100vw;
    height:100vh;
    overflow:hidden;
    position:relative;
    background:#f6aeb8;
}
.marquee.show{
    display:block;
}
.marquee.fullscreen{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    z-index:50;
}

/* 2Ô∏è‚É£ Canvas cao g·∫•p ƒë√¥i, 2 n·ª≠a tr√™n/d∆∞·ªõi gi·ªëng nhau ƒë·ªÉ loop tr√¥i t·ª´ tr√™n xu·ªëng */
.canvas{
    position:absolute;
    width:100vw;
    height:200vh;
    top:0;
    left:0;
    will-change:transform;
    backface-visibility:hidden;
}
.canvas-layer-1{
    animation: moveDown 18s linear infinite;
}
.canvas-layer-2{
    animation: moveDown 12s linear infinite;
}

/* 3Ô∏è‚É£ ·∫¢nh r·∫£i lo·∫°n (position absolute) */
.canvas img{
    position:absolute;
    width:180px;
    height:230px;
    object-fit:cover;
    border-radius:16px;
    box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
.canvas-layer-2 img{
    width:130px;
    height:170px;
    opacity:0.85;
}

/* 4Ô∏è‚É£ Tr√¥i t·ª´ tr√™n xu·ªëng, loop v√¥ t·∫≠n kh√¥ng gi·∫≠t */
@keyframes moveDown{
    0%{ transform: translateY(0); }
    100%{ transform: translateY(-50%); }
}

#canvas-confetti{ position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:100; }

.btn-speaker{
    position:fixed;
    bottom:20px;
    right:20px;
    z-index:60;
    width:48px;
    height:48px;
    border-radius:50%;
    border:none;
    background:rgba(255,255,255,0.9);
    box-shadow:0 4px 16px rgba(0,0,0,0.2);
    cursor:pointer;
    font-size:22px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition: transform 0.2s, background 0.2s;
}
.btn-speaker:hover{
    transform: scale(1.08);
    background:#fff;
}
.btn-speaker.playing{ background: rgba(255,182,193,0.95); }

/* Responsive mobile */
@media (max-width: 768px){
    body{ padding:12px; }
    .page-wrap{ max-width:100%; padding:12px 0; }
    .title{ font-size:1.15rem; }
    .subtitle{ font-size:1.25rem; }
    .password-view .pwd-card{
        flex-direction:column;
        width:95%;
        max-width:100%;
        border-radius:20px;
    }
    .password-view .pwd-card-img{
        flex:none;
        width:100%;
        min-width:0;
        min-height:180px;
        border-radius:20px 20px 0 0;
    }
    .password-view .pwd-card .card-body{ padding:18px; }
    .password-view .pwd-title{ font-size:15px; margin-bottom:12px; }
    .password-view .password-display{ font-size:17px; padding:10px 12px; min-height:24px; margin-bottom:16px; }
    .password-view .keypad{ gap:8px; }
    .password-view .key{ padding:10px; font-size:15px; }
    .card-wrap{ width:92%; max-width:100%; }
    .card-spread{ min-height:280px; }
    .inside-img{ min-height:220px; }
    .gift-box-wrap{ transform: scale(0.85); transform-origin:center bottom; }
    .gift-page{ min-height:60vh; }
    .btn-open-gift, .btn-next-page{ padding:12px 24px; font-size:0.95rem; }
    .canvas img{ width:120px; height:155px; }
    .canvas-layer-2 img{ width:85px; height:115px; }
    .memory-img{ width:120px; }
    .memory-img.hero{ bottom:120px; }
    .btn-speaker{ width:44px; height:44px; bottom:16px; right:16px; font-size:20px; }
}
@media (max-width: 480px){
    body{ padding:8px; }
    .title{ font-size:1rem; }
    .subtitle{ font-size:1.1rem; }
    .password-view .pwd-card-img{ min-height:150px; }
    .password-view .pwd-card .card-body{ padding:14px; }
    .password-view .pwd-title{ font-size:14px; }
    .password-view .key{ padding:8px; font-size:14px; }
    .card-spread{ min-height:240px; }
    .inside-img{ min-height:180px; }
    .gift-box-wrap{ transform: scale(0.75); }
    .canvas img{ width:90px; height:120px; }
    .canvas-layer-2 img{ width:70px; height:95px; }
    .memory-img{ width:100px; }
    .memory-img.hero{ bottom:100px; }
}
</style>
</head>
<body>

<div class="hearts" aria-hidden="true">
    <span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span>
    <span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span>
</div>
<div class="love-floats" aria-hidden="true">
    <span class="love-float">üíï</span><span class="love-float">üíó</span><span class="love-float">üíñ</span><span class="love-float">üíï</span>
    <span class="love-float">üíó</span><span class="love-float">üíñ</span><span class="love-float">üíï</span><span class="love-float">üíó</span>
</div>

<div id="passwordView" class="view active">
    <div class="landing" id="landing">
        <div class="password-view">
            <div class="pwd-card">
                <div class="pwd-card-img">
                    <img src="cat.jpg" class="avatar" alt="">
                </div>
                <div class="card-body">
                    <div class="pwd-title">Nh·∫≠p ng√†y sinh c·ªßa b·∫°n üíñüíñüíñ</div>
                    <div class="password-display" id="display"></div>
                    <div class="keypad">
                        <button type="button" class="key" data-num="1">1</button>
                        <button type="button" class="key" data-num="2">2</button>
                        <button type="button" class="key" data-num="3">3</button>
                        <button type="button" class="key" data-num="4">4</button>
                        <button type="button" class="key" data-num="5">5</button>
                        <button type="button" class="key" data-num="6">6</button>
                        <button type="button" class="key" data-num="7">7</button>
                        <button type="button" class="key" data-num="8">8</button>
                        <button type="button" class="key" data-num="9">9</button>
                        <button type="button" class="key special" data-clear>C</button>
                        <button type="button" class="key" data-num="0">0</button>
                        <button type="button" class="key special" data-del>‚Üê</button>
                    </div>
                    <div class="pwd-msg" id="pwdMessage"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="page-wrap" id="pageWrap">
    <h1 class="title">Ch√∫c m·ª´ng sinh nh·∫≠t c√¥ h·∫ßu g√°i!</h1>
    <p class="subtitle">MISOUWU</p>

    <div id="cardView" class="view">
        <div class="card-wrap">
            <div class="card-spread">
                <div class="inside">
                    <img src="cmsn.png" class="inside-img" alt="L·ªùi ch√∫c sinh nh·∫≠t">
                </div>
                <div class="cover" id="cover" title="Click ƒë·ªÉ m·ªü thi·ªáp">
                    <div class="cover-front">
                        <img src="maid.jpg" alt="">
                    </div>
                    <div class="cover-back"></div>
                </div>
            </div>
        </div>
        <div class="btn-next-wrap" id="btnNextWrap">
            <button type="button" class="btn-next-page" id="btnNextPage">B·∫•t ng·ªù c√≤n ·ªü ph√≠a sau</button>
        </div>
    </div>

    <div id="giftView" class="view">
        <div class="gift-page">
            <div class="gift-box-wrap" id="giftBoxWrap">
                <div class="gift-body"></div>
                <div class="gift-lid"></div>
            </div>
            <button type="button" class="btn-open-gift" id="btnOpenGift">M·ªü qu√†</button>
        </div>
        <div class="memory-container" id="memoryContainer"></div>
        <div class="marquee" id="marquee">
<div class="canvas canvas-layer-1" id="canvasLayer1">
                    <img src="ms1.jpg" alt=""><img src="ms2.jpg" alt=""><img src="ms3.jpg" alt=""><img src="ms4.jpg" alt=""><img src="ms5.jpg" alt=""><img src="ms6.jpg" alt=""><img src="ms7.jpg" alt=""><img src="ms8.jpg" alt=""><img src="ms9.jpg" alt=""><img src="ms10.jpg" alt=""><img src="ms11.jpg" alt=""><img src="ms12.jpg" alt=""><img src="ms13.jpg" alt="">
                    <img src="ms1.jpg" alt=""><img src="ms2.jpg" alt=""><img src="ms3.jpg" alt=""><img src="ms4.jpg" alt=""><img src="ms5.jpg" alt=""><img src="ms6.jpg" alt=""><img src="ms7.jpg" alt=""><img src="ms8.jpg" alt=""><img src="ms9.jpg" alt=""><img src="ms10.jpg" alt=""><img src="ms11.jpg" alt=""><img src="ms12.jpg" alt=""><img src="ms13.jpg" alt="">
                </div>
                <div class="canvas canvas-layer-2" id="canvasLayer2">
                    <img src="ms1.jpg" alt=""><img src="ms2.jpg" alt=""><img src="ms3.jpg" alt=""><img src="ms4.jpg" alt=""><img src="ms5.jpg" alt=""><img src="ms6.jpg" alt=""><img src="ms7.jpg" alt=""><img src="ms8.jpg" alt=""><img src="ms9.jpg" alt=""><img src="ms10.jpg" alt=""><img src="ms11.jpg" alt=""><img src="ms12.jpg" alt=""><img src="ms13.jpg" alt="">
                    <img src="ms1.jpg" alt=""><img src="ms2.jpg" alt=""><img src="ms3.jpg" alt=""><img src="ms4.jpg" alt=""><img src="ms5.jpg" alt=""><img src="ms6.jpg" alt=""><img src="ms7.jpg" alt=""><img src="ms8.jpg" alt=""><img src="ms9.jpg" alt=""><img src="ms10.jpg" alt=""><img src="ms11.jpg" alt=""><img src="ms12.jpg" alt=""><img src="ms13.jpg" alt="">
                </div>
        </div>
    </div>
</div>

<button type="button" class="btn-speaker" id="btnSpeaker" title="T·∫Øt nh·∫°c / B·∫≠t nh·∫°c">üîä</button>

<audio id="bgm" loop preload="auto">
    <source src="anhdomiso.mp3" type="audio/mpeg">
</audio>

<script>
var cover = document.getElementById("cover");
var bgm = document.getElementById("bgm");
var btnNextPage = document.getElementById("btnNextPage");
var btnNextWrap = document.getElementById("btnNextWrap");
var cardView = document.getElementById("cardView");
var giftView = document.getElementById("giftView");
var btnOpenGift = document.getElementById("btnOpenGift");
var giftBoxWrap = document.getElementById("giftBoxWrap");
var memoryContainer = document.getElementById("memoryContainer");
var marquee = document.getElementById("marquee");
var canvasLayer1 = document.getElementById("canvasLayer1");
var canvasLayer2 = document.getElementById("canvasLayer2");
var btnSpeaker = document.getElementById("btnSpeaker");
var landing = document.getElementById("landing");
var pageWrap = document.getElementById("pageWrap");
var pwdMessage = document.getElementById("pwdMessage");

var PWD = "180206";
var input = "";

function updateDisplay(){ document.getElementById("display").innerText = "*".repeat(input.length); }
function addNum(n){ if(input.length >= 8) return; input += n; updateDisplay(); checkPwd(); }
function clearPwd(){ input = ""; updateDisplay(); }
function delPwd(){ input = input.slice(0,-1); updateDisplay(); }

function checkPwd(){
    if(input.length !== PWD.length) return;
    if(input === PWD){
        pwdMessage.className = "pwd-msg success";
        pwdMessage.innerText = "ƒê√∫ng r·ªìi üíñ ƒêang m·ªü thi·ªáp...";
        landing.classList.add("fade-out");
        setTimeout(function(){
            document.getElementById("passwordView").classList.remove("active");
            document.getElementById("cardView").classList.add("active");
            pageWrap.classList.add("show");
        }, 1600);
    } else {
        pwdMessage.className = "pwd-msg";
        pwdMessage.innerText = "Sai r·ªìi üò¢";
        setTimeout(function(){ input = ""; updateDisplay(); pwdMessage.innerText = ""; }, 1000);
    }
}

document.querySelectorAll(".password-view .key[data-num]").forEach(function(btn){
    btn.onclick = function(){ addNum(btn.getAttribute("data-num")); };
});
document.querySelector(".password-view .key[data-clear]").onclick = clearPwd;
document.querySelector(".password-view .key[data-del]").onclick = delPwd;

function updateSpeakerIcon(){
    if(bgm.paused){
        btnSpeaker.textContent = "üîà";
        btnSpeaker.classList.remove("playing");
        btnSpeaker.title = "B·∫≠t nh·∫°c";
    } else {
        btnSpeaker.textContent = "üîä";
        btnSpeaker.classList.add("playing");
        btnSpeaker.title = "T·∫Øt nh·∫°c";
    }
}

btnSpeaker.onclick = function(){
    if(bgm.paused){
        bgm.play().catch(function(){});
    } else {
        bgm.pause();
    }
    updateSpeakerIcon();
};

bgm.play().then(function(){ updateSpeakerIcon(); }).catch(function(){ updateSpeakerIcon(); });

function randomizeMarqueePositions(canvasEl){
    var images = canvasEl.querySelectorAll("img");
    var n = images.length;
    var half = n / 2;
    var vSpread = 42;
    var hSpread = 75;
    var tops1 = [];
    var lefts = [];
    for (var i = 0; i < half; i++) {
        tops1.push((i / (half - 1 || 1)) * vSpread + Math.random() * 5);
        lefts.push(Math.random() * hSpread + 5);
    }
    images.forEach(function(img, i){
        img.style.left = lefts[i % half] + "%";
        if (i < half) {
            img.style.top = tops1[i] + "%";
        } else {
            img.style.top = (50 + tops1[i - half]) + "%";
        }
    });
}

cover.onclick = function(){
    if(cover.classList.contains("flipped")) return;
    cover.classList.add("flipped");
    bgm.play().catch(function(){});
    setTimeout(function(){
        confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
        setTimeout(function(){ confetti({ particleCount: 80, spread: 100, origin: { y: 0.5 } }); }, 300);
        btnNextWrap.classList.add("show");
    }, 1150);
};

btnNextPage.onclick = function(){
    cardView.classList.remove("active");
    giftView.classList.add("active");
};

function createHeroImage(container){
    var img = document.createElement("img");
    img.src = "ms1.jpg";
    img.classList.add("memory-img", "hero");
    container.appendChild(img);
    var rotateDeg = Math.random() * 20 - 10;
    img.animate([
        { transform: "translateX(-50%) scale(0)", opacity: 0 },
        { transform: "translate(-50%, -300px) scale(1) rotate(" + rotateDeg + "deg)", opacity: 1 }
    ], { duration: 1500, easing: "cubic-bezier(.17,.67,.83,.67)", fill: "forwards" });
}

function createFloatingImages(container){
    var images = ["ms2.jpg", "ms3.jpg", "ms4.jpg", "ms5.jpg", "ms6.jpg", "ms7.jpg", "ms8.jpg", "ms9.jpg"];
    images.forEach(function(src){
        var img = document.createElement("img");
        img.src = src;
        img.classList.add("memory-img");
        img.style.left = "50%";
        img.style.bottom = "200px";
        container.appendChild(img);
        var angle = Math.random() * 2 * Math.PI;
        var distance = Math.random() * 400 + 150;
        var x = Math.cos(angle) * distance;
        var y = Math.sin(angle) * distance - 200;
        img.animate([
            { transform: "translate(-80px, 0) scale(0.3)", opacity: 1 },
            { transform: "translate(" + (-80 + x) + "px, " + y + "px) scale(0.6)", opacity: 0 }
        ], { duration: 2000, easing: "ease-out" });
        setTimeout(function(){ img.remove(); }, 2000);
    });
}

function showMarquee(){
    randomizeMarqueePositions(canvasLayer1);
    randomizeMarqueePositions(canvasLayer2);
    marquee.classList.add("show");
    marquee.classList.add("fullscreen");
    giftBoxWrap.classList.add("hide");
    btnOpenGift.classList.add("hide");
}

function openGift(){
    if(giftBoxWrap.classList.contains("opened")) return;
    giftBoxWrap.classList.add("opened");
    document.body.style.transition = "filter 0.8s";
    document.body.style.filter = "brightness(1.2)";
    setTimeout(function(){ document.body.style.filter = "brightness(1)"; }, 800);
    confetti({ particleCount: 100, spread: 70, origin: { y: 0.55, x: 0.5 } });
    setTimeout(function(){ confetti({ particleCount: 80, spread: 100, origin: { y: 0.5 } }); }, 200);
    setTimeout(function(){ confetti({ particleCount: 60, spread: 120, origin: { y: 0.6 } }); }, 400);
    createHeroImage(memoryContainer);
    createFloatingImages(memoryContainer);
    setTimeout(function(){
        memoryContainer.innerHTML = "";
        showMarquee();
    }, 3000);
}

btnOpenGift.onclick = openGift;
</script>
</body>
</html>
